<!DOCTYPE html>
<head>
	<title>OptiMed</title>
	<!-- <img class="bg"> -->
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!-- styles -->
	<link href="//netdna.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet" media="screen">
</head>
<body class="container">
	<h4>Note: The following has been tested successfully on NU Discovery cluster</h4>
	<h3> 1. Connect to the Discovery cluster</h3>
	<h3> 2. Install/load Anaconda</h3>
	We have two options here:
	<ol>
		<li>Obtain and install Miniconda executable specifically for python 2.7</li>
		<a id='1st'></a>
		<strong>Obtain</strong>:
<pre>$ wget https://repo.anaconda.com/miniconda/Miniconda2-py27_4.8.3-Linux-x86_64.sh</pre>
        <strong>Install</strong>:
<pre>$ bash Miniconda2-py27_4.8.3-Linux-x86_64.sh</pre>
        <li>Load Anaconda module and activate it</li>
        <a id='2nd'></a>
<pre>$ module load anaconda2/2018.12
$ echo ". /shared/centos7/anaconda2/2018.12/etc/profile.d/conda.sh" >> ~/.bashrc
$ source ~/.bashrc</pre>
</ol>

<h3> 3. Reserve a gpu/multigpu compute node</h3>
<pre>$ srun -p gpu --nodes=1 --pty --gres=gpu:1 --time=04:00:00 --export=ALL /bin/bash</pre>
<h3> 4. Activate the environment</h3>
If you went with the <a href="#1st">first option</a>:
<pre>$ source miniconda2/bin/activate</pre>
If you went with the <a href="#2nd">second option</a>:
<pre>$ conda activate</pre>
If everything goes well, <code>(base)</code> will show up next to your <code>username@computenode</code> in shell, as
<pre>(base)[username@c0001]$</pre>
<h3> 5. Load the required modules</h3>
<pre>$ module load boost/1.63.0
$ module load cuda/10.2</pre>
<h3> 6. Create a conda environemnt for PyGBe (takes a while)</h3>
First, delete the previously created <code>pygbe-env</code> environment from the old installation. You might have named it differently. If that's the case, you can see your environments at
<pre>$ ls ~/.conda/envs</pre>
<h4>To remove the old environment</h4>
<pre>$ conda remove -n pygbe-env --all</pre>
or delete the env folder
<pre>$ rm -rf ~/.conda/envs/pygbe-env</pre>
<h4>To create the new environment</h4>
<pre>$ conda create -n pygbe-env python=2.7</pre>
<h3> 7. Activate the PyGBe environment</h3>
<pre>$ conda activate pygbe-env</pre>
<h3> 8. Install the remaining dependencies</h3>
<h4>8.1 <code>numpy</code> and <code>scipy</code> </h4>
<pre>$ conda install numpy scipy</pre>
<h4>8.2 <code>pycuda</code> </h4>
before installing pycuda, we want to make sure there is absolutely no trace of previous installations left on your machine. So we delete them from the potential locations.
<pre>$ rm -rf ~/.conda/pkgs/pycuda*
$ rm -rf ~/.local/lib/python2.7/site-packages/pycuda*</pre>
Now install <code>pycuda</code>
<pre>$ pip install -Iv pycuda</pre>
<h3> 9. Clone the repository</h3>
<pre>$ git clone https://github.com/alineu/pygbe.git</pre>
or
<pre>$ git clone git@github.com:alineu/pygbe.git
$ cd pygbe</pre>
<h3> 10. checkout the asymmetric branch</h3>
<pre>$ git checkout asymmetric</pre>
<h3> 11. Download and install SWIG</h3>
<pre>$ mkdir src
$ cd src
$ wget https://versaweb.dl.sourceforge.net/project/swig/swig/swig-3.0.12/swig-3.0.12.tar.gz
$ tar -xvzf swig-3.0.12.tar.gz
$ cd swig-3.0.12
$ ./configure --prefix=$PWD
$ make
$ make install</pre>
<h3> 12. Install PyGBe and test the installation</h3>
<h4>12.1 Install</h4>
<pre>$ cd ../../bem_pycuda/
$ make all</pre>
<h4>12.2 Test</h4>
<pre>$ python main_asymmetric.py input_files/his.param input_files/his_stern.config --asymmetric --chargeForm</pre>
If the library is installed properly, you should see something like
<pre>Run started on:
Date: year/m/d
Time: hr:min:sec
Reading pqr for region 2 from ../geometry/his/his_prot.pqr
Reading surface 0 from file ../geometry/his/his_d01
Time load mesh: 0.036644
Removed areas=0: 0
Reading surface 1 from file ../geometry/his/his_d01_stern
Time load mesh: 0.041806
Removed areas=0: 81
Total elements : 1555
Total equations: 3110
...
...
...
Totals:
Esolv = -19.045255 kcal/mol
Esurf = 0.000000 kcal/mol
Ecoul = -119.087367 kcal/mol
Time = 15.916039 s</pre>
<h3> 13. Whenever you're done:</h3>
<pre>$ conda deactivate
$ conda deactivate</pre>
twice!
<h3> Note</h3>
Next time, when you connect to a GPU compute node you only need to run the following to enable and use <code>PyGBe</code> library:
<h4>Activate the Anaconda Module</h4>
If you installed Miniconda locally (via <a href="#1st">first option</a>):
<pre>$ source activate miniconda2</pre>
otherwise,
<pre>$ module load anaconda2/2018.12
$ conda activate</pre>
<h4>Activate the PyGBe Environment</h4>
<pre>$ conda activate pygbe-env</pre>
<h4>Load the Rest of the Modules</h4>
<pre>$ module load boost/1.63.0
$ module load cuda/10.2</pre>
The library should be ready to use!
<h4>Important</h4>
You might have to add the location of <code>pycuda</code> library to your <code>PATH</code> if <code>Python</code> fails to import the library. You can do this by adding
<pre>export PATH=$PATH:path_to_pycuda</pre>
to your <code>~/.bashrc</code> file (and then source it!).
<code> path_to_pycuda</code> is the location where the <code>pycuda</code> library is installed, e.g. <code>$HOME/.conda/envs/pygbe-env/lib/python2.7/site-packages/pycuda</code>
If you don't know the location of <code>pycuda</code> library you can find it using
<pre>find ~ -type d -name 'pycuda*'</pre>
</body>
</html>